"use strict";(self.webpackChunkbg_kala_school_web_app_backend=self.webpackChunkbg_kala_school_web_app_backend||[]).push([[4263],{22282:(S,g,e)=>{e.r(g),e.d(g,{default:()=>ie});var t=e(67294),a=e(95489),n=e(49656),f=e(96486),l=e(87751),i=e(87462),o=e(15861),P=e(64687),d=e.n(P),r=e(97132),h=e(45697),_=e.n(h),Z=e(78718),B=e.n(Z),z=e(27361),L=e.n(z),F=e(57557),A=e.n(F),$=e(23724),C=e(80831),s=e(28702),R=e(41363),b=e(38683);const H=async T=>{const{get:U}=(0,a.getFetchClient)(),{data:M}=await U(`/admin/users/${T}`);return M.data},Y=async(T,U)=>{const{put:M}=(0,a.getFetchClient)(),{data:I}=await M(`/admin/users/${T}`,U);return I.data},k=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.username.label",defaultMessage:"Username"},name:"username",placeholder:{id:"Auth.form.username.placeholder",defaultMessage:"e.g. Kai_Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"global.password",defaultMessage:"Password"},name:"password",type:"password",size:{col:6,xs:12},autoComplete:"new-password"},{intlLabel:{id:"Auth.form.confirmPassword.label",defaultMessage:"Password confirmation"},name:"confirmPassword",type:"password",size:{col:6,xs:12},autoComplete:"new-password"}],[{intlLabel:{id:"Auth.form.active.label",defaultMessage:"Active"},name:"isActive",type:"bool",size:{col:6,xs:12}}]];var Q=e(17405),j=e(81288),V=function(){return window&&window.strapi&&window.strapi.isEE?e(12201).Z:e(31605).Z}(),x=["email","firstname","lastname","username","isActive","roles"],D=function(U){var M=U.canUpdate,I=(0,r.useIntl)(),c=I.formatMessage,J=(0,n.useRouteMatch)("/settings/users/:id"),K=J.params.id,de=(0,n.useHistory)(),ce=de.push,ue=(0,a.useAppInfos)(),me=ue.setUserDisplayName,w=(0,a.useNotification)(),ee=(0,a.useOverlayBlocker)(),ge=ee.lockApp,pe=ee.unlockApp;(0,a.useFocusWhenNavigate)();var te=(0,$.useQuery)(["user",K],function(){return H(K)},{retry:!1,onError:function(u){var m=u.response.status;m===403&&(w({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}}),ce("/")),console.log(u.response.status)}}),Ee=te.status,v=te.data,fe=function(){var p=(0,o.Z)(d().mark(function u(m,O){var N,X,y,q,ne;return d().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return ge(),E.prev=1,E.next=4,Y(K,A()(m,"confirmPassword"));case 4:N=E.sent,w({type:"success",message:c({id:"notification.success.saved",defaultMessage:"Saved"})}),X=a.auth.getUserInfo(),K.toString()===X.id.toString()&&(a.auth.setUserInfo(N),y=L()(m,"username")||(0,b.Pp)(m.firstname,m.lastname),me(y)),O.setValues(B()(m,x)),E.next=17;break;case 11:E.prev=11,E.t0=E.catch(1),q=(0,b.Iz)(E.t0.response.data),ne=Object.keys(q).reduce(function(re,oe){return re[oe]=q[oe].id,re},{}),O.setErrors(ne),w({type:"warning",message:L()(E.t0,"response.data.error.message","notification.error")});case 17:pe();case 18:case"end":return E.stop()}},u,null,[[1,11]])}));return function(m,O){return p.apply(this,arguments)}}(),ae=Ee!=="success",Me=ae?{id:"app.containers.Users.EditPage.header.label-loading",defaultMessage:"Edit user"}:{id:"app.containers.Users.EditPage.header.label",defaultMessage:"Edit {name}"},G=Object.keys(B()(v,x)).reduce(function(p,u){return u==="roles"?(p[u]=(v?.roles||[]).map(function(m){var O=m.id;return O}),p):(p[u]=v?.[u],p)},{}),ve=G.username||(0,b.Pp)(G.firstname,G.lastname),se=c(Me,{name:ve});return ae?t.createElement(s.Main,{"aria-busy":"true"},t.createElement(a.SettingsPageTitle,{name:"Users"}),t.createElement(s.HeaderLayout,{primaryAction:t.createElement(s.Button,{disabled:!0,startIcon:t.createElement(R.Check,null),type:"button",size:"L"},c({id:"global.save",defaultMessage:"Save"})),title:se,navigationAction:t.createElement(a.Link,{startIcon:t.createElement(R.ArrowLeft,null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},c({id:"global.back",defaultMessage:"Back"}))}),t.createElement(s.ContentLayout,null,t.createElement(a.LoadingIndicatorPage,null))):t.createElement(s.Main,null,t.createElement(a.SettingsPageTitle,{name:"Users"}),t.createElement(C.Formik,{onSubmit:fe,initialValues:G,validateOnChange:!1,validationSchema:Q.YM},function(p){var u=p.errors,m=p.values,O=p.handleChange,N=p.isSubmitting;return t.createElement(a.Form,null,t.createElement(s.HeaderLayout,{primaryAction:t.createElement(s.Button,{disabled:N||!M,startIcon:t.createElement(R.Check,null),loading:N,type:"submit",size:"L"},c({id:"global.save",defaultMessage:"Save"})),title:se,navigationAction:t.createElement(a.Link,{startIcon:t.createElement(R.ArrowLeft,null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},c({id:"global.back",defaultMessage:"Back"}))}),t.createElement(s.ContentLayout,null,v?.registrationToken&&t.createElement(s.Box,{paddingBottom:6},t.createElement(V,{registrationToken:v.registrationToken})),t.createElement(s.Stack,{spacing:7},t.createElement(s.Box,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(s.Stack,{spacing:4},t.createElement(s.Typography,{variant:"delta",as:"h2"},c({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"Details"})),t.createElement(s.Grid,{gap:5},k.map(function(X){return X.map(function(y){return t.createElement(s.GridItem,(0,i.Z)({key:y.name},y.size),t.createElement(a.GenericInput,(0,i.Z)({},y,{disabled:!M,error:u[y.name],onChange:O,value:m[y.name]||""})))})})))),t.createElement(s.Box,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(s.Stack,{spacing:4},t.createElement(s.Typography,{variant:"delta",as:"h2"},c({id:"global.roles",defaultMessage:"User's role"})),t.createElement(s.Grid,{gap:5},t.createElement(s.GridItem,{col:6,xs:12},t.createElement(j.Z,{disabled:!M,error:u.roles,onChange:O,value:m.roles}))))))))}))};D.propTypes={canUpdate:_().bool.isRequired};const le=D,ie=()=>{const T=(0,a.useNotification)(),U=(0,t.useMemo)(()=>({read:l.Z.settings.users.read,update:l.Z.settings.users.update}),[]),{isLoading:M,allowedActions:{canRead:I,canUpdate:c}}=(0,a.useRBAC)(U),{state:J}=(0,n.useLocation)(),K=(0,f.get)(J,"from","/");return(0,t.useEffect)(()=>{M||!I&&!c&&T({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}})},[M,I,c,T]),M?t.createElement(a.LoadingIndicatorPage,null):!I&&!c?t.createElement(n.Redirect,{to:K}):t.createElement(le,{canUpdate:c})}},82464:(S,g,e)=>{e.d(g,{Z:()=>B});var t=e(67294),a=e(45697),n=e.n(a),f=e(28702),l=e.n(f),i=e(95489),o=e.n(i),P=e(41363),d=e.n(P),r=e(74855),h=e.n(r),_=e(97132);const Z=({children:z,target:L})=>{const F=(0,i.useNotification)(),{formatMessage:A}=(0,_.useIntl)(),$=()=>{F({type:"info",message:{id:"notification.link-copied"}})},C=A({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"});return t.createElement(i.ContentBox,{endAction:t.createElement(r.CopyToClipboard,{onCopy:$,text:L},t.createElement(f.IconButton,{label:C,noBorder:!0,icon:t.createElement(P.Duplicate,null)})),title:L,titleEllipsis:!0,subtitle:z,icon:t.createElement("span",{style:{fontSize:32}},"\u2709\uFE0F"),iconBackground:"neutral100"})};Z.propTypes={children:n().oneOfType([n().element,n().string]).isRequired,target:n().string.isRequired};const B=Z},31605:(S,g,e)=>{e.d(g,{Z:()=>P});var t=e(67294),a=e(97132),n=e(45697),f=e.n(n),l=e(63871),i=e(82464);const o=({registrationToken:d})=>{const{formatMessage:r}=(0,a.useIntl)(),h=`${window.location.origin}${l.Z}auth/register?registrationToken=${d}`;return t.createElement(i.Z,{target:h},r({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"}))};o.defaultProps={registrationToken:""},o.propTypes={registrationToken:f().string};const P=o},81288:(S,g,e)=>{e.d(g,{Z:()=>$});var t=e(67294),a=e(45697),n=e.n(a),f=e(97132),l=e(28702),i=e.n(l),o=e(23724),P=e.n(o),d=e(71893),r=e(41363),h=e.n(r),_=e(95489),Z=e.n(_);const B=d.keyframes`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,z=d.default.div`
  animation: ${B} 2s infinite linear;
`,L=()=>t.createElement(z,null,t.createElement(r.Loader,null)),F=async()=>{const{get:C}=(0,_.getFetchClient)(),{data:s}=await C("/admin/roles");return s.data},A=({disabled:C,error:s,onChange:R,value:b})=>{const{status:H,data:Y}=(0,o.useQuery)(["roles"],F,{staleTime:5e4}),{formatMessage:W}=(0,f.useIntl)(),k=s?W({id:s,defaultMessage:s}):"",Q=W({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),j=W({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),V=W({id:"app.components.Select.placeholder",defaultMessage:"Select"}),x=H==="loading"?t.createElement(L,null):void 0;return t.createElement(l.Select,{id:"roles",disabled:C,error:k,hint:j,label:Q,name:"roles",onChange:D=>{R({target:{name:"roles",value:D}})},placeholder:V,multi:!0,startIcon:x,value:b,withTags:!0,required:!0},(Y||[]).map(D=>t.createElement(l.Option,{key:D.id,value:D.id},W({id:`global.${D.code}`,defaultMessage:D.name}))))};A.defaultProps={disabled:!1,error:void 0},A.propTypes={disabled:n().bool,error:n().string,onChange:n().func.isRequired,value:n().array.isRequired};const $=A},17405:(S,g,e)=>{e.d(g,{YM:()=>d,Rw:()=>l});var t=e(53209),a=e(95489);const n={firstname:t.Z_().trim().required(a.translatedErrors.required),lastname:t.Z_(),email:t.Z_().email(a.translatedErrors.email).lowercase().required(a.translatedErrors.required),username:t.Z_().nullable(),password:t.Z_().min(8,a.translatedErrors.minLength).matches(/[a-z]/,"components.Input.error.contain.lowercase").matches(/[A-Z]/,"components.Input.error.contain.uppercase").matches(/\d/,"components.Input.error.contain.number"),confirmPassword:t.Z_().min(8,a.translatedErrors.minLength).oneOf([t.iH("password"),null],"components.Input.error.password.noMatch").when("password",(r,h)=>r?h.required(a.translatedErrors.required):h)},l={...n,currentPassword:t.Z_().when(["password","confirmPassword"],(r,h,_)=>r||h?_.required(a.translatedErrors.required):_),preferedLanguage:t.Z_().nullable()},o={roles:t.IX().min(1,a.translatedErrors.required).required(a.translatedErrors.required)},d=t.Ry().shape({...n,isActive:t.Xg(),...o})},12201:(S,g,e)=>{e.d(g,{Z:()=>P});var t=e(67294),a=e(97132),n=e(45697),f=e.n(n),l=e(63871),i=e(82464);const o=({registrationToken:d})=>{const{formatMessage:r}=(0,a.useIntl)();return d?t.createElement(i.Z,{target:`${window.location.origin}${l.Z}auth/register?registrationToken=${d}`},r({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})):t.createElement(i.Z,{target:`${window.location.origin}${l.Z}auth/login`},r({id:"app.components.Users.MagicLink.connect.sso",defaultMessage:"Send this link to the user, the first login can be made via a SSO provider."}))};o.defaultProps={registrationToken:""},o.propTypes={registrationToken:f().string};const P=o}}]);
